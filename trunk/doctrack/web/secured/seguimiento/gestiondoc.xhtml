<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html   xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:f="http://xmlns.jcp.org/jsf/core">
        <h:body>
            <ui:composition template="../../dashboard.xhtml">
                <ui:define name="content">  
                    <p:growl id="growl" showDetail="true" life="5000" /> 
                    <!--list -->
                    <h:form id="SegLisFormListForm">
                        <p:panel header="Seguimientos - Documentos sin concluir" style="width: 90%">
                            <p:dataTable id="datalist" var="seguimientos" value="#{gestionDocBean.listaSeguimiento}" lazy="false" rowKey="#{seguimientos.id}" paginator="true" rows="10" rowsPerPageTemplate="10,20,30,40,50" selectionMode="single" selection="#{gestionDocBean.seguimiento}" >
                                <p:ajax event="rowSelect"   update="verButton,moverButton,procesarButton,concluirButton"/>
                                <p:ajax event="rowUnselect" update="verButton,moverButton,procesarButton,concluirButton"/>

                                <p:column headerText="Nª Seg."><h:outputText value="#{seguimientos.id}"/></p:column>
                                <p:column headerText="Nª Doc."><h:outputText value="#{seguimientos.idDocumento.numeroDoc}"/></p:column>
                                <p:column headerText="Fecha de Entrada"><h:outputText value="#{seguimientos.fechaentrada}"/></p:column>
                                <p:column headerText="Caratula"><h:outputText value="#{seguimientos.idDocumento.descripcion}"/></p:column>
                                <p:column headerText="Estado General"><h:outputText value="#{seguimientos.estadogeneral}"/></p:column>
                                
                                <f:facet name="footer">
                                    <div>
                                        <p:commandButton value="Ver" id="verButton" icon="ui-icon-plus" oncomplete="PF('SegVerDialog').show()" update=":SegVerForm" disabled="#{empty gestionDocBean.seguimiento}" />
                                        <p:commandButton value="Procesar" id="procesarButton" icon="ui-icon-pencil" update=":DocProcesarForm" oncomplete="PF('DocProcesarDialog').show()" disabled="#{empty gestionDocBean.seguimiento  or !loginBean.currentUser.idRol.ingresadocumentos.equals('Si')}"/>
                                        <p:commandButton value="Mover" id="moverButton" icon="ui-icon-pencil" update=":DocMoverForm" oncomplete="PF('DocMoverDialog').show()" disabled="#{empty gestionDocBean.seguimiento}"/>
                                        <p:commandButton value="Concluir" id="concluirButton" actionListener="#{gestionDocBean.concluirDocumento()}" icon="fa-check-square-o" update="datalist growl" disabled="#{empty gestionDocBean.seguimiento}" >
                                            <p:confirm header="Confirmar acción" message="¿Esta Seguro de cambiar a estado CONCLUIDO el Documento seleccionado?" icon="ui-icon-alert"/><!--disabled bloquea si la seleccion es vacia-->
                                        </p:commandButton>
                                    </div>
                                </f:facet>
                                
                            </p:dataTable>
                        </p:panel>
                        <ui:include src="../templates/confirmation.xhtml"/>
                    </h:form>
                    
                    <!--dialog para ver el seguimiento-->
                    <p:dialog header="Ficha Del Documento" id="SegVerDg" widgetVar="SegVerDialog" minHeight="40" width="500" height="300" modal="true" resizable="false" closeOnEscape="true" appendTo="@(body)">
                        <!--el modal es para que se comporte como un modal el dialog, resizable false para que no se modifiquen las dimensiones, closeOnEscape para que se pueda cerrar con el escape
                        appendTo @body para que se visualize enfrente-->
                        <h:form id="SegVerForm">
                            <h:panelGroup id="display" rendered="true">
                                <p:panelGrid columns="2" style="width: 100%">
                                    <h3 style="margin-top:0">Seguimiento</h3>
                                    <p:separator />
                                    <p:outputLabel value="Número de Seguimiento"  />
                                    <p:outputLabel  value="#{gestionDocBean.seguimiento.id}" />
                                    
                                    <p:outputLabel value="Fecha de Entrada" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.fechaentrada}"/>

                                    <p:outputLabel value="Estado General" />
                                    <p:outputLabel id="estadoGeneral" value="#{gestionDocBean.seguimiento.estadogeneral}"/>
                                    
                                    <h3 style="margin-top:0">Documento</h3>
                                    <p:separator />
                                    <p:outputLabel value="Número de Documento" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.idDocumento.numeroDoc}" />
                                    
                                    <p:outputLabel value="Caratulado como" />
                                    <p:inputTextarea value="#{gestionDocBean.seguimiento.descripcion}" cols="50"/>
                                    
                                    <p:outputLabel value="Tipo de Documento" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.idDocumento.idTipodoc.nombre}" />
                                    
                                    <p:outputLabel value="Observación del Documento" />
                                    <p:inputTextarea value="#{gestionDocBean.seguimiento.idDocumento.observacion}" cols="50"/>
                                    
                                    <p:outputLabel value="Supervisión quien solicita" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.idDocumento.idSupervicion.idDistrito.nombre}"/>
                                    
                                    <h3 style="margin-top:0">Tramitante</h3>
                                    <p:separator />
                                    <p:outputLabel value="Nombre Completo" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.idDocumento.idTramitante.nombreCompleto}"/>
                                    <p:outputLabel value="Cedula de Identidad" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.idDocumento.idTramitante.ci}"/>
                                    <p:outputLabel value="Teléfono" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.idDocumento.idTramitante.telefono}"/>
                                    <p:outputLabel value="Dirección" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.idDocumento.idTramitante.direccion}"/>
                                    <p:outputLabel value="Correo Electronico" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.idDocumento.idTramitante.email}"/>
                                    
                                </p:panelGrid>
                                
                                <!--botones de guardar y cancelar -->
                                <div style="padding-top: 10px; width: 99%; display: block-inline; text-align: right">
                                    <p:commandButton value="Cerrar" update="display" oncomplete="PF('SegVerDialog').hide()"/>
                                </div>
                            </h:panelGroup>
                        </h:form>
                    </p:dialog>
                    
                    <!--dialog para el boton procesar -->
                    <p:dialog header="Procesar Documento" id="DocProcesarDg" widgetVar="DocProcesarDialog" modal="true" resizable="false" closeOnEscape="true" appendTo="@(body)">
                        <h:form id="DocProcesarForm">
                            <p:growl id="growl" showDetail="true" life="5000" /> 
                            <h:panelGroup id="display" rendered="true">
                                <p:messages id="msgs" />
                                <p:panelGrid columns="3">
                                    
                                    <p:outputLabel value="Número de Seguimiento" />
                                    <p:inputText id="numSeg" value="#{gestionDocBean.seguimiento.id}" disabled="true" required="true" size="50" maxlength="50" />
                                    
                                    <p:outputLabel value="Número de Documento" />
                                    <p:inputText id="numDoc" value="#{gestionDocBean.seguimiento.idDocumento.numeroDoc}" disabled="true" required="true" size="50" maxlength="50" />
                                    
                                    <p:outputLabel value="Sector destinatario del Documento" />
                                    <h:selectOneMenu  value="#{gestionDocBean.areas}"> 
                                        <f:selectItems value="#{gestionDocBean.listaAreas}" var="areas" itemLabel="#{areas.nombre}" itemValue="#{areas.nombre}" />
                                    </h:selectOneMenu>  

                                    <p:outputLabel for="asunto" value="Asunto a Tratar" /><!--le paso el asunto a la variable asuntoGest-->
                                    <p:inputTextarea id="asunto" rows="6" cols="33" value="#{gestionDocBean.asuntoGest}" required="true">
                                        <f:validateLength minimum="1" maximum="50" />
                                        <p:ajax update="msgAsunto" event="keyup" />
                                    </p:inputTextarea>
                                    <p:message for="asunto" id="msgAsunto" display="icon" />
                                    
                                    <p:outputLabel for="observacion" value="Observación" /><!--le paso el asunto a la variable asuntoGest-->
                                    <p:inputTextarea id="observacion" rows="6" cols="33" value="#{gestionDocBean.obsGest}" required="true">
                                        <f:validateLength minimum="1" maximum="200" />
                                        <p:ajax update="msgObservacion" event="keyup" />
                                    </p:inputTextarea>
                                    <p:message for="observacion" id="msgObservacion" display="icon" />

                                </p:panelGrid>
                                <!--botones de guardar y cancelar -->
                                <div style="padding-top: 10px; width: 99%; display: block-inline; text-align: right">
                                    <p:commandButton value="Guardar" action="#{gestionDocBean.procesarDocumento}" update="growl,display,:SegLisFormListForm:datalist" oncomplete="PF('DocProcesarDialog').hide();"/>                              
                                    <p:commandButton value="Cancelar" update="display" oncomplete="PF('DocProcesarDialog').hide()"/>
                                </div>
                            </h:panelGroup>
                        </h:form>
                    </p:dialog>
                    
                    <p:dialog header="Mover Documento a un Nuevo Sector" id="DocMoverDg" widgetVar="DocMoverDialog" modal="true" resizable="false" closeOnEscape="true" appendTo="@(body)">
                        <h:form id="DocMoverForm">
                            <p:growl id="growl" showDetail="true" life="5000" /> 
                            <h:panelGroup id="display" rendered="true">
                                <p:messages id="msgs" />
                                <p:panelGrid columns="3">
                                    
                                    <p:outputLabel value="Número de Seguimiento" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.id}" />
                                    
                                    <p:outputLabel value="Número de Documento" />
                                    <p:outputLabel value="#{gestionDocBean.seguimiento.idDocumento.numeroDoc}" />
                                    
                                    <p:outputLabel value="Sector destinatario del Documento" />
                                    <h:selectOneMenu  value="#{gestionDocBean.areas}"> 
                                        <f:selectItems value="#{gestionDocBean.listaAreas}" var="areas" itemLabel="#{areas.nombre}" itemValue="#{areas.nombre}" />
                                    </h:selectOneMenu>  

                                    <p:outputLabel for="asunto" value="Asunto a Tratar" /><!--le paso el asunto a la variable asuntoGest-->
                                    <p:inputTextarea id="asunto" rows="6" cols="33" value="#{gestionDocBean.asuntoGest}" required="true">
                                        <f:validateLength minimum="1" maximum="50" />
                                        <p:ajax update="msgAsunto" event="keyup" />
                                    </p:inputTextarea>
                                    <p:message for="asunto" id="msgAsunto" display="icon" />
                                    
                                    <p:outputLabel for="observacion" value="Observación" /><!--le paso el asunto a la variable asuntoGest-->
                                    <p:inputTextarea id="observacion" rows="6" cols="33" value="#{gestionDocBean.obsGest}" required="true">
                                        <f:validateLength minimum="1" maximum="200" />
                                        <p:ajax update="msgObservacion" event="keyup" />
                                    </p:inputTextarea>
                                    <p:message for="observacion" id="msgObservacion" display="icon" />

                                </p:panelGrid>
                                <!--botones de guardar y cancelar -->
                                <div style="padding-top: 10px; width: 99%; display: block-inline; text-align: right">
                                    <p:commandButton value="Guardar" action="#{gestionDocBean.moverDocumento}" update="growl,display,:SegLisFormListForm:datalist" oncomplete="PF('DocMoverDialog').hide();"/>                              
                                    <p:commandButton value="Cancelar" update="display" oncomplete="PF('DocMoverDialog').hide()"/>
                                </div>
                            </h:panelGroup>
                        </h:form>
                    </p:dialog>
                    
                </ui:define>
            </ui:composition>
        </h:body>
</html>
